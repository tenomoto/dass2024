---
title: モデル
---

気象や海洋でモデルは、予報モデルのみを指す。
ここでは、状態変数から観測変数に変換する測定モデル（観測演算子）も含める。

## 線型観測 

もっとも簡単な観測演算子は、状態変数の場所で値そのものを返すものである。$j$個目の観測が $i$番目の状態の値だとすると 

$$
\mathbf{y}_j = h(\mathbf{x})_i\;i=1,\dots,n,\,j=1,\dots,m
$$ {#eq-model-linear}
となる。
$m\ne n$であることに注意する。
すなわち、何点かおきや偏りがある場合など、状態のすべての位置で測定が行われるとは限らない。
この観測演算子の接線型は、$i$と$j$の指す位置が同じ要素が1であるような$m\times n$行列である。
状態の位置（と順序）で全て測定し$m=n$である場合は、単位行列になる。 
$$
\mathbf{H} = \mathbf{I}
$$ {#eq-model-identity}
観測位置が状態変数の位置と一致しない場合は、内挿が必要となる。


## 非線型観測

風速は典型的な非線型観測演算子である。

$$
|u| = h(u, v) = \sqrt{u^2 + v^2}
$$ {#eq-model-us}

風速の接線型演算子は
$$
\mathbf{H} = \frac{\partial|\mathbf{u}|}{\partial \mathbf{u}} =
\begin{pmatrix}
  \frac{u}{|\mathbf{u}|} \\
  \frac{v}{|\mathbf{u|}} \\
\end{pmatrix}
$$ {#eq-model-dusdu}


```{r}
#| code-fold: true
#| file: "R/eakf.R"
```

```{r}
#| code-fold: true
#| file: "R/run_wind_ens.R"
```
::: {.callout-caution title="注意"}
非線型の場合は、平均に観測演算子を適用したものと観測演算子を適用したアンサンブルの平均は異なる。

$\overline{h(\mathbf{x})}\ne h(\bar{x})$

風速の例では、$\overline{h(\mathbf{x^\mathrm{a}})} = \bar{\mathbf{z}}^\mathrm{a}_k = 3.05\,\mathrm{ms}^{-1},\,h(\bar{\mathbf{x}}^\mathrm{a})=2.48\,\mathrm{ms}^{-1}$である。
:::

## Lorenz-96モデル

@Lorenz-Emanuel:1998
は追加の観測をどこで行うと効果的か考察するために、次の簡単なモデルを用いた。
$$
\frac{\mathrm{d}X_j}{\mathrm{d}t} = (X_{j+1} - X_{j-2})X_{j-1} - X_j + F
$$ $j=1, .., J$は格子点の番号で、$J=40$がよく用いられる。
格子点は緯度円上に等間隔に並んでいる。
$X$は気温や渦度のようなスカラーの気象学的要素を表す。
右辺第1項は移流を表す非線型項で全エネルギー$(\sum_jX_j^2)/2$は保存される。
右辺第2項は消散を表す線型項で全エネルギーを減少させる。
係数が1になるようにスケールされていて、消散の時定数は5日である。
強制項$F$は、時空間平均$\bar{X}$の範囲$[0,\,F]$、分散$\sigma$の範囲$[0,\,F/2]$を決める。
$F>8/9$のとき波数8の波が成長する。

```{r}
#| code-fold: true
l96 <- function(x, F) {
  n <- length(x)
  (x[c(2:n, 1)] - x[c(n-1, n, 1:(n-2))]) * x[c(n, 1:(n-1))] - x + F
}

rk4 <- function(f, x, dt, opts) {
  k1 <- f(x, opts)
  k2 <- f(x + 0.5 * dt * k1, opts)
  k3 <- f(x + 0.5 * dt * k2, opts)
  k4 <- f(x + dt * k3, opts)
  x + (k1 + 2 * k2 + 2 * k3 + k4) * dt / 6
}
```

$F=3.85$で1000ステップ先まで4次のRunge-Kutta法で時間積分する。
時間刻み幅0.05は6時間に対応する。

```{r}
#| code-fold: true
nj <- 40
nstep <- 1001
x.hist <- matrix(0, nj, nstep)
x <- rnorm(nj)
F <- 3.85
dt <- 0.05
for (i in 1:nstep-1) {
  x <- rk4(l96, x, dt, F)
  x.hist[,i] <- x
}
```

等値線を描いてみる。

```{r}
#| code-fold: true
t <- seq(0, nstep*dt, length.out=nstep)
filled.contour(1:nj, t, x.hist, nlevel=11,
               ylim=rev(range(t)), xlab="j", ylab="time")
```

縞々の数と向きから、波数は8で位相は時間とともに西に進んでいることが分かる。
これに対し初期に振幅が大きな場所は時間とともに東に進んでいる。
このようなふるまいは、定常解$\bar{X}=F$に対する摂動方程式の解で説明できる。
$$
\frac{\mathrm{d}x_j}{\mathrm{d}t} = (x_{j+1} - x_{j-2})F - x_j
$$ $X_j=\bar{X}+x_j$とし摂動の2次の項は無視した。
波動解を仮定すると、$F>8/9$のときに波長$L=2\pi/k=2\pi/\cos^{-1}(1/4)\approx=4.767$の波が成長することが示される。波長はおよそ5なので、$J=40$に対しては波数は8に対応する。
このとき不安定波の位相速度$c=-(\sin k+2\sin 2k)(F/k)$はおよそ$-1.09$、群速度$c_\mathrm{g}=-(\cos k + 2\cos 2k)F$はおよそ$+1.17$となる。
このほかにも不安定モードが存在しており、$F>2.0$では波数4から12までの波が同時に不安定に、$F>4.0$では波の成長で強制項の効果を打ち消すことができなくなりカオスに遷移する。
データ同化では$F=8$がよく用いられるようである。

::: {.callout-note title="練習"}
-   $F$をいろいろと変えてみよう。
-   平均や分散が理論どおりか確認してみよう。
-   初期摂動の影響を調べてみよう。試行のたびに結果はどのように変わるか。
:::
